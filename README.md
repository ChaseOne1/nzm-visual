# NZM-Visual
## 简介
本项目用于辅助规划**逆战未来**游戏局内的经济支配, 通过**传统视觉识别技术**分析当前经济和攻击力数据, 按局内经济系统规则计算得到当前金币数量下最大可升级到的攻击力和金币余额, 并实时悬浮显示。  
__不会触发ACE异常提示__。
## 构建 
项目使用Rust语言编写, 实现了屏幕截图、数字识别、数据处理、悬浮显示等模块。
### 模板生成
*可以在Release页面的发布版本得到该步骤的所有产物*
1. 构建截图工具，在`./target/release/`下可以找到构建产物`capture.exe`;
```bash
cargo build --releases --bin capture
```
#### 金币数字模板生成
1. 构建模板处理工具得到模板， 构建后可在`./target/release/`下找到构建产物`money_digit_templates.exe`，将其移动到一个新的文件夹:
```bash
cargo build --release --bin money_digit_templates
```
2. 以无边窗口化模式运行游戏，并在僵尸猎场模式对局内，通过上一步得到的`capture.exe`进行截图并与上一步所的工具保存在同一个文件夹。需得到金币区域包含有明显数字`0..9`的屏幕截图若干，金币数超过10万的截图1张，29级攻击力的截图29张，建议挑选地图暗处使得对应区域拥有较暗背景;

3. 使用可以查看像素坐标的图片查看工具（例如`Windows 画图`）打开上一步得到的金币数量超过10万的屏幕截图，找出金币数最高位数字的左上角像素坐标（该像素必须满足右侧紧贴数字，下方紧贴数字）和和金币数最低为数字的右下角像素坐标（该像素必须满足左侧紧贴数字，上方紧贴数字），然后手动截取金币区域得到数字`0..9`的单个数字截图（截图必须满足两侧不留非数字像素空白，上下不留非数字像素空白）保存为`0.png..9.png`;
4. 在`./src/main.rs`中修改变量`money`处的`imageops::crop_imm`函数调用实参，将上一步得到的左上角坐标`(x1, y1)`和右下角坐标`(x2, y2)`按格式`x1, y1, x2 - x1, y2 - y1`对应替换原处内容;
5. 运行模板处理工具，应该在相同目录内得到`./money_digit_templates/`文件夹，其中含有`0..9`的单个数字模板。
#### 攻击力模板生成
1. 构建模板处理工具得到模板， 构建后可在`./target/release/`下找到构建产物`attack_templates.exe`，将其移动到一个新的文件夹:
```bash
cargo build --release --bin attack_templates
```
2. 使用图片查看工具，打开得到的攻击力为`1500%`的屏幕截图，找出攻击力区域的左上角像素坐标（要求该像素右侧紧贴数字1，下方紧贴数字1）和右下角像素坐标（要求该像素左侧紧贴百分号，上方紧贴百分号），并截取该区域内的攻击力截图，保存为`{level}.png`，其中level对应实际攻击力数值;
3. 在`./src/main.rs`中修改变量`attack`处的`imageops::crop_imm`函数调用实参，将上一步得到的左上角坐标`(x1, y1)`和右下角坐标`(x2, y2)`按格式`x1, y1, x2 - x1, y2 - y1`对应替换原处内容，对`./src/bin/attack_templates.rs`内的变量`binary`处的相同函数调用进行同样的修改;
4. 运行模板处理工具，应该在相同目录内得到`./attack_templates/`文件夹，其中含有每集攻击力的模板。
#### 主程序构建
1. 在项目根目录构建后可以在`./target/release/`下找到构建产物`nzm-visual.exe`:
```bash
cargo build --release --bin nzm-visual
```
2. 将金币数字模板和攻击力模板文件夹与主程序放置在同一个文件夹内。
### 运行
在进入游戏后，打开主程序`nzm-visual.exe`即可。
### 注意
对于不同分辨率、DPI、缩放等参数，可能需要手动调整截取区域，以保证识别准确率。若使用Release页面所得到的模板文件应该保证截取区域像素大小与模板文件图像尺寸相同，以获得更准确的识别结果。  
Release页面的模板文件截取参数为：2560x1600分辨率下，缩放100%。
